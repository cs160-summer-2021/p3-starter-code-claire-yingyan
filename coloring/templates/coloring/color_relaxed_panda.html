{% load static %}

<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Relaxed Mode</title>

    <!-- font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Otomanopee+One&display=swap" rel="stylesheet">
    <!-- jquery -->
    <script type="text/javascript" src="{% static 'coloring/vendors/jquery/jquery-3.3.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'coloring/vendors/paper/paper-full.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'coloring/vendors/bootstrap/css/bootstrap.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'coloring/style.css' %}" />


    <style type="text/css">
        #color-palette {
            /* width: 390px; */
            background-color: none;
            display: flex;
            flex-wrap: wrap;
            position: absolute;
            bottom: 150px;
            left: 3%;
            /* left: 32%; */

        }

        .swatch {
            /* width: 90px;
			height: 50px; */
            width: 90px;
            height: 80px;
            -moz-border-radius: 12px;
            -webkit-border-radius: 12px;
            border-radius: 12px;
            margin: 3px;
        }

        #myCanvas {
            display: block;
            margin-left: auto;
            margin-right: auto;
            width: 90%;
            height: 100%;
            /* padding-left: 0;
			padding-right: 0; */
            /* margin-left: auto;
			margin-right: auto; */
            /* display: block; */
        }
    </style>

    <script type="text/javascript" canvas="canvas">
        window.onload = function () {
            var canvas = document.getElementById('myCanvas');
            var lastColor = null;

            // coloring page
            var mandala = {
                item: null,
                lastClicked: null,
                filePath: '/static/coloring/images/panda.svg'
            };

            // color palette
            var cp = {
                history: ["#000000"], // black selected by default
                options: [],
                $container: $('#color-palette')
            }

            function myCustomInteraction() {
                var tool = new paper.Tool();

                tool.onMouseDown = function (event) {
                    var hit = mandala.item.hitTest(event.point, { tolerance: 10, fill: true });
                    if (hit) {
                        // Color pallette keeps track of the full history of colors, though we
                        // only color in with the most-recent color.
                        hit.item.fillColor = cp.history[cp.history.length - 1];
                    }
                }
                tool.onMouseDrag = function (event) {
                    var hit = mandala.item.hitTest(event.point, { tolerance: 10, fill: true });
                    if (hit) {
                        // Color pallette keeps track of the full history of colors, though we
                        // only color in with the most-recent color.
                        hit.item.fillColor = cp.history[cp.history.length - 1];
                    }
                }

            }

            // create a color palette with the given colors
            function createColorPalette(colors) {

                // create a swatch for each color
                for (var i = colors.length - 1; i >= 0; i--) {
                    var $swatch = $("<div>").css("background-color", colors[i])
                        .addClass("swatch");
                    $swatch.click(function () {
                        // add color to the color palette history
                        cp.history.push($(this).css("background-color"));
                        $(this).css('border', '5px solid black');
                        if (lastColor != null) {
                            $(lastColor).css('border', 'none');
                        }
                        lastColor = this;
                    });
                    cp.$container.append($swatch);
                }
                // add white to color palette
                var $swatch = $("<div>").css("background-color", "white")
                    .addClass("swatch");
                $swatch.click(function () {
                    // add color to the color palette history
                    cp.history.push($(this).css("background-color"));
                    $(this).css('border', '2px solid black');
                    if (lastColor != null) {
                        $(lastColor).css('border', 'none');
                    }
                    lastColor = this;
                });

                cp.$container.append($swatch);
            }


            // loads a set of colors from a json to create a color palette
            function getColorsCreatePalette() {
                cp.$container.html(" ");
                $.getJSON('/static/coloring/vendors/material/material-colors.json', function (colors) {
                    var keys = Object.keys(colors);
                    for (var i = keys.length - 1; i >= 0; i--) {
                        cp.options.push(colors[keys[i]][500]);
                    }
                    createColorPalette(cp.options);
                });
            }

            function init(custom) {
                paper.setup(canvas);
                getColorsCreatePalette();

                paper.project.importSVG(mandala.filePath, function (item) {
                    console.log(item);
                    //print("hello");
                    mandala.item = item._children["design-freepik"];
                    paper.project.insertLayer(0, mandala.item);

                    if (custom) {
                        myCustomInteraction();
                    } else {
                        myGradientInteraction();
                    }

                });
            }

            // Set up the mandala interactivity.
            init(true);
        }
    </script>
</head>

<body>
    <h1>Paintify</h1>
    <h2>Relaxed Mode</h2>
    <canvas id="myCanvas" width="750px" height="750px"></canvas>
    <div id="color-palette"></div>
</body>
<footer>
    <a href="/coloring/">
        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="currentColor" class="bi bi-house-door"
            viewBox="0 0 16 16">
            <path
                d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z" />
        </svg>
    </a>
    <a href="/coloring/info">
        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="currentColor" class="bi bi-info-square"
            viewBox="0 0 16 16">
            <path
                d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z" />
            <path
                d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z" />
        </svg>
    </a>
    <a href="/coloring/rec_creative">
        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="currentColor" class="bi bi-palette"
            viewBox="0 0 16 16">
            <path
                d="M8 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM5.5 7a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm.5 6a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z" />
            <path
                d="M16 8c0 3.15-1.866 2.585-3.567 2.07C11.42 9.763 10.465 9.473 10 10c-.603.683-.475 1.819-.351 2.92C9.826 14.495 9.996 16 8 16a8 8 0 1 1 8-8zm-8 7c.611 0 .654-.171.655-.176.078-.146.124-.464.07-1.119-.014-.168-.037-.37-.061-.591-.052-.464-.112-1.005-.118-1.462-.01-.707.083-1.61.704-2.314.369-.417.845-.578 1.272-.618.404-.038.812.026 1.16.104.343.077.702.186 1.025.284l.028.008c.346.105.658.199.953.266.653.148.904.083.991.024C14.717 9.38 15 9.161 15 8a7 7 0 1 0-7 7z" />
        </svg>
    </a>
    </a>
    <a href="/coloring/rec_relaxed">
        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="currentColor" class="bi bi-paint-bucket"
            viewBox="0 0 16 16">
            <path
                d="M6.192 2.78c-.458-.677-.927-1.248-1.35-1.643a2.972 2.972 0 0 0-.71-.515c-.217-.104-.56-.205-.882-.02-.367.213-.427.63-.43.896-.003.304.064.664.173 1.044.196.687.556 1.528 1.035 2.402L.752 8.22c-.277.277-.269.656-.218.918.055.283.187.593.36.903.348.627.92 1.361 1.626 2.068.707.707 1.441 1.278 2.068 1.626.31.173.62.305.903.36.262.05.64.059.918-.218l5.615-5.615c.118.257.092.512.05.939-.03.292-.068.665-.073 1.176v.123h.003a1 1 0 0 0 1.993 0H14v-.057a1.01 1.01 0 0 0-.004-.117c-.055-1.25-.7-2.738-1.86-3.494a4.322 4.322 0 0 0-.211-.434c-.349-.626-.92-1.36-1.627-2.067-.707-.707-1.441-1.279-2.068-1.627-.31-.172-.62-.304-.903-.36-.262-.05-.64-.058-.918.219l-.217.216zM4.16 1.867c.381.356.844.922 1.311 1.632l-.704.705c-.382-.727-.66-1.402-.813-1.938a3.283 3.283 0 0 1-.131-.673c.091.061.204.15.337.274zm.394 3.965c.54.852 1.107 1.567 1.607 2.033a.5.5 0 1 0 .682-.732c-.453-.422-1.017-1.136-1.564-2.027l1.088-1.088c.054.12.115.243.183.365.349.627.92 1.361 1.627 2.068.706.707 1.44 1.278 2.068 1.626.122.068.244.13.365.183l-4.861 4.862a.571.571 0 0 1-.068-.01c-.137-.027-.342-.104-.608-.252-.524-.292-1.186-.8-1.846-1.46-.66-.66-1.168-1.32-1.46-1.846-.147-.265-.225-.47-.251-.607a.573.573 0 0 1-.01-.068l3.048-3.047zm2.87-1.935a2.44 2.44 0 0 1-.241-.561c.135.033.324.11.562.241.524.292 1.186.8 1.846 1.46.45.45.83.901 1.118 1.31a3.497 3.497 0 0 0-1.066.091 11.27 11.27 0 0 1-.76-.694c-.66-.66-1.167-1.322-1.458-1.847z" />
        </svg>
    </a>

</footer>

</html>